{% extends "layouts/base.html" %}
{% load static %}

{% block subtitle %}VPD{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/charts.css' %}">
{% endblock %}

{% block navbar %}
  {% include 'partials/navbar.html' with is_charts_page=True %}
{% endblock %}

{% block content %}
<section id="overview-section" class="overview-section">
  <article id="chart-content">
    <div class="chart-container">
      {{ chart|safe }}
    </div>
  </article>
  
  <h2>Sensores</h2>
  <article>
    <div class="sensor-table-container">
      <table class="sensor-table">
        <thead>
          <tr>
            <th>Sala</th>
            <th>Sensor</th>
            <th class="center">Temp. (°C)</th>
            <th class="center">Hum. (%)</th>
            <th class="center">VPD (kPa)</th>
          </tr>
        </thead>
        <tbody>
          {% regroup room_data by room as room_list %}
          {% for room in room_list %}
            {% with sensor_count=room.list|length %}
              {% for sensor in room.list %}
                <tr>
                  {% if forloop.first %}
                    <td class="room-cell" rowspan="{{ sensor_count }}">{{ room.grouper }}</td>
                  {% endif %}
                  <td class="mono">{{ sensor.sensor }}</td>
                  <td class="mono center">{{ sensor.t|floatformat:1 }}</td>
                  <td class="mono center">{{ sensor.h|floatformat:1 }}</td>
                  <td class="mono center">{{ sensor.vpd|floatformat:2 }}</td>
                </tr>
              {% endfor %}
            {% endwith %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </article>
  
  <article>
    <h1>VPD</h1>
    <p>Este es el contenido del VPD.</p>
    <h2>¿Qué es el VPD?</h2>
    <p>El Déficit de Presión de Vapor (VPD, por sus siglas en inglés) es una medida crucial ...</p>
    <div class="math-block">
      $$VPD = e_s(T) \times (1 - RH/100)$$
    </div>
    <p>donde \(e_s(T)\) es la presión de vapor de saturación calculada ...</p>
    <div class="math-block">
      $$e_s(T) = 0.6108 \times \exp\left(\frac{17.27 \times T}{T + 237.3}\right)$$
    </div>
    <p>Un VPD adecuado es fundamental para el desarrollo; valores bajos o altos indican ...</p>
  </article>
</section>
{% endblock %}
