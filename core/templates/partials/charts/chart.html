{% load static %}

{% block content %}
<div id="chart-partial">
    <div id="chart-container">
        {% if error %}
            <div class="alert alert-danger">
                <h4 class="alert-heading">Error</h4>
                <p>{{ error }}</p>
                <hr>
                <p class="mb-0">Por favor, verifique que el servidor de la API esté funcionando y vuelva a intentar.</p>
            </div>
        {% else %}
            {{ chart_html|safe }}
        {% endif %}
    </div>
    <div id="toggle-buttons" class="button-group">
        <div id="toggle-buttons-timeframe">
            <button class="button {% if selected_timeframe == '1min' %}active{% endif %}" 
                    hx-get="/chart/?timeframe=1min&metric={{ metric }}" 
                    hx-target="#chart-partial" 
                    hx-swap="outerHTML">1'</button>
            <button class="button {% if selected_timeframe == '30min' %}active{% endif %}"
                    hx-get="/chart/?timeframe=30min&metric={{ metric }}"
                    hx-target="#chart-partial"
                    hx-swap="outerHTML">30'</button>
            <button class="button {% if selected_timeframe == '1h' %}active{% endif %}"
                    hx-get="/chart/?timeframe=1h&metric={{ metric }}"
                    hx-target="#chart-partial"
                    hx-swap="outerHTML">1h</button>
            <button class="button {% if selected_timeframe == '4h' %}active{% endif %}"
                    hx-get="/chart/?timeframe=4h&metric={{ metric }}"
                    hx-target="#chart-partial"
                    hx-swap="outerHTML">4h</button>
            <button class="button {% if selected_timeframe == '1d' %}active{% endif %}" 
                    hx-get="/chart/?timeframe=1d&metric={{ metric }}" 
                    hx-target="#chart-partial" 
                    hx-swap="outerHTML" 
                    {% if selected_timeframe != '1d' %}disabled{% endif %}>1d</button>
        </div>
        <div class="vertical-separator"></div>
        <div id="toggle-buttons-online">
            <button class="button online-button {% if selected_timeframe == '5s' %}active{% endif %}"
                    hx-get="/chart/?timeframe=5s&metric={{ metric }}"
                    hx-target="#chart-partial"
                    hx-swap="outerHTML">online</button>
        </div>
        <div class="vertical-separator"></div>
        <div id="toggle-buttons-metric">
            <button class="button metric {% if metric == 't' %}active{% endif %}"
            hx-get="/chart/?timeframe={{ selected_timeframe }}&metric=t"
            hx-target="#chart-partial"
            hx-swap="outerHTML">Temp</button>
            <button class="button metric {% if metric == 'h' %}active{% endif %}"
            hx-get="/chart/?timeframe={{ selected_timeframe }}&metric=h"
            hx-target="#chart-partial"
            hx-swap="outerHTML">Hum</button>
        </div>
    </div>
    <pre>
        <strong>Resumen de Datos:</strong>
        <strong>Total registros:</strong> {{ debug.num_points }}
        <strong>Puntos graficados:</strong> {{ debug.plotted_points }}
        <strong>Sensores:</strong> {{ debug.sensors|join:", " }}
        <strong>Primer registro:</strong> {{ debug.first_record.timestamp }} ({{ debug.first_record.sensor }}: {{ debug.first_record.value }})
        <strong>Último registro:</strong> {{ debug.last_record.timestamp }} ({{ debug.last_record.sensor }}: {{ debug.last_record.value }})
        <strong>Primer registro online:</strong> {{ debug.first_record_online.timestamp }} ({{ debug.first_record_online.sensor }}: {{ debug.first_record_online.value }})
        <strong>Segundo registro online:</strong> {{ debug.second_record_online.timestamp }} ({{ debug.second_record_online.sensor }}: {{ debug.second_record_online.value }})
        <strong>Intervalo:</strong> {{ selected_timeframe }}
    </pre>
</div>
{% endblock %}
